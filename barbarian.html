<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="/css/barbarian.css">
<script src="/js/jquery.min.js"></script>
<link rel="stylesheet" href="/css/jquery.mobile.min.css">
<link rel="manifest" href="/manifest.json">
<script src="/js/jquery.mobile.min.js"></script>
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1">
</head>
<script>

let screenNumber = 0;
let actionsLocked = false;
let isPaused = false;
let numLives = 3;
let isHints = true;
let isSoundOn = true;
let windowWidth = undefined;
let pauseFrameIndex = 0;
let keypressTime;
let lastKeypressTime;

$(document).ready(function(){

    // Include constants
    $.getScript('/js/constants.js', function() {
    // Include util module
    $.getScript('/js/util.js', function() {
    // Include sound module
    $.getScript('/js/sound.js', function() {
    // Include sprite definition
    $.getScript('/js/sprites.js', function() {
    // Include the obstacles module
    $.getScript('/js/obstacles.js', function() {
    // Include the fighting module
    $.getScript('/js/fighting.js', function() {
    // Include animation module
    $.getScript('/js/animation.js', function() {
    // Include keypress events
    $.getScript('/js/events.js', function() {

    let viewportmeta = document.querySelector('meta[name="viewport"]');

    let width = $(window).width();
    let height = $(window).height();

    let scalingDimension = undefined;
    if (width > height) {
        scalingDimension = width;
    } else {
        scalingDimension = height - 50;
    }

    viewportmeta.content = viewportmeta.content.replace(/initial-scale=[^,]+/, 'initial-scale=' + (scalingDimension / 1400));

    $(window).orientationchange(function(event) {

        viewportmeta.content = viewportmeta.content.replace(/initial-scale=[^,]+/, 'initial-scale=' + (scalingDimension / 1400));
        viewportmeta.content = viewportmeta.content.replace(/width=[^,]+/, 'width=' + width);
        viewportmeta.content = viewportmeta.content.replace(/height=[^,]+/, 'height=' + height);
    });


    // Bind the swipeHandler callback function to the swipe event on div.box
    $('.backdrop').on('swiperight', swipeRightHandler);
    $('.backdrop').on('swipeleft', swipeLeftHandler);
    $('.backdrop').on('taphold', tapHoldHandler);
    $('.backdrop').on('click', clickHandler);

    function clickHandler(event) {
        if (compareProperty(BARBARIAN_CHARACTER, STATUS, DEAD)) {
            handleKeypress(KEYPRESS[KP_SPACE]);
        }
        let topOfBarbarian = parseInt(stripPxSuffix(getProperty(BARBARIAN_CHARACTER, SPRITE).css('height')))/2 + parseInt(stripPxSuffix(getProperty(BARBARIAN_CHARACTER, SPRITE).css('bottom')));
        let barbarianLeft = getProperty(BARBARIAN_CHARACTER, SPRITE).offset().left + parseInt(stripPxSuffix(getProperty(BARBARIAN_CHARACTER, SPRITE).css('width')) / 2);
        let pageX = event.originalEvent.pageX;
        let clickY = event.originalEvent.pageY;
        if (clickY < 200) {
            handleKeypress(KEYPRESS[KP_JUMP]);
        } else if (pageX > barbarianLeft) {
            if (compareProperty(BARBARIAN_CHARACTER, ACTION, WALK)) {
                handleKeypress(KEYPRESS[KP_RUN]);
            } else {
                handleKeypress(KEYPRESS[KP_RIGHT]);
            }
        } else if (pageX <= barbarianLeft) {
            if (compareProperty(BARBARIAN_CHARACTER, ACTION, WALK)) {
                handleKeypress(KEYPRESS[KP_RUN]);
            } else {
                handleKeypress(KEYPRESS[KP_LEFT]);
            }
        }
    }

    function tapHoldHandler(event) {
        handleKeypress(KEYPRESS[KP_PAUSE]);
    }

    function attackHandler(event) {
        handleKeypress(KEYPRESS[KP_ATTACK]);
    }

    function swipeRightHandler(event){
        if (compareProperty(BARBARIAN_CHARACTER, DIRECTION, LEFT)) {
            handleKeypress(KEYPRESS[KP_STOP]);
        } else {
            handleKeypress(KEYPRESS[KP_ATTACK]);
        }
    }

    function swipeLeftHandler(event){
        if (compareProperty(BARBARIAN_CHARACTER, DIRECTION, RIGHT)) {
            handleKeypress(KEYPRESS[KP_STOP]);
        } else {
            handleKeypress(KEYPRESS[KP_ATTACK]);
        }
    }


        // Don't allow screen resizing
    $(window).resize(function(){
        window.resizeTo(SCREEN_WIDTH, SCREEN_HEIGHT);
    });

    windowWidth = 1400;

    renderSpriteFrame(MONSTER_CHARACTER, WALK, getProperty(MONSTER_CHARACTER, DIRECTION), 0, getProperty(MONSTER_CHARACTER, SPRITE).height());

    $(document).keydown(function(e) {
        handleKeypress(e.which);
        e.preventDefault(); // prevent the default action (scroll / move caret)
    });



})})})})})})})})});
</script>
</head>
<body style="touch-action: pan-y;">
<div class="backdrop">
    <img class="life1" src="images/player_icon.png"></img>
    <img class="life2" src="images/player_icon.png"></img>
    <div class="bridge"></div>
    <div class="barbarian"></div>
    <div class="monster"></div>
    <div class="dog"></div>
    <div class="death"></div>
    <div class="pause_message"><h2>Paused</h2></div>
    <div class="hints_message_off"><h2>Hints Off</h2></div>
    <div class="hints_message_on"><h2>Hints On</h2></div>
    <div class="sound_message_off"><h2>Sound Off</h2></div>
    <div class="sound_message_on"><h2>Sound On</h2></div>
    <div class="demo_over_message">
        <h1>Thank you for playing this demo!</h1>
        <p>
            Press <strong>[spacebar]</strong> to play again<br/>
        </p>
    </div>
    <div class="game_over">
        <h1>Game Over</h1>
        <p>
            Press <strong>[spacebar]</strong> to play again<br/>
            Press <strong>C</strong> to see controls
        </p>
    </div>
    <div class="start_message">
        <h1>Barbarian!</h1>
        <p>
            Created by Christopher Rhodes (chrisguyrhodes@gmail.com)<br/><br/>
            This is a twist on a game I played as a kid. I created sprites from YouTube videos,<br/>
            animated them and created my own version of game. Enjoy!<br/><br/>
            Artwork and concept from Barbarian by Psygnosis<br/><br/>
            Theme Song: Death Of Rexor (Conan The Barbarian/Soundtrack Version)<br/><br/>
            Press <strong>[spacebar]</strong> to play<br/>
            Press <strong>C</strong> to see controls
        </p>
    </div>
    <div class="controls_message">
        <h1>Control menu</h1>
        <p>
            <strong><-</strong> Left<br/>
            <strong>-></strong> Right<br/>
            <strong>A</strong> Attack<br/>
            <strong>J</strong> Jump<br/>
            <strong>R</strong> Run<br/>
            <strong>P</strong> Pause<br/>
            <strong>H</strong> Hints Toggle<br/>
            <strong>X</strong> Sound Toggle<br/><br/>

            Press <strong>M</strong> for main menu
        </p>
    </div>
</div>
</body>
</html>


<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="./barbarian.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script> 
$(document).ready(function(){ 

    // Include constants
    $.getScript('http://localhost/constants.js', function() {
    // Include animation module
    $.getScript('http://localhost/animator.js', function() {
    // Include action definitions
    $.getScript('http://localhost/actions.js', function() {

    barbarian = $(".barbarian");
    monster = $(".monster");
    monster.css('background-position', -1*14*monster.width() + 'px ' + -1*monster.height() + 'px');
    
    windowWidth = $(document).width() - barbarian.width();
    action = STOP;
    direction = RIGHT;
    var keypressTime;
    var lastKeypressTime;

    //animateSprite(monster, ATTACK_FRAMES[LEFT]['FRAMES'], ATTACK, LEFT, ATTACK_FRAMES[LEFT]['HEIGHT_OFFSET']);

    $(document).keydown(function(e) {
        var barbarian = $(".barbarian");

        keypressTime = new Date().getTime();

        if (!shouldThrottle(lastKeypressTime)) {
            lastKeypressTime = keypressTime;
            keypressTime = new Date().getTime();
            switch(e.which) {
               case KEYPRESS[KP_RUN]:
                    if(action !== RUN) {
                        run(direction);
                    }
                    break;
                case KEYPRESS[KP_JUMP]:
                    if (action !== JUMP) {
                        jump(direction);
                    }
                    break;
                case KEYPRESS[KP_STOP]:
                    action = stop(direction);
                    break;
                case KEYPRESS[KP_RIGHT]:
                    if (action !== WALK || direction !== RIGHT) {
                        direction = RIGHT;
                        walk(direction);
                    }
                    break;
                case KEYPRESS[KP_LEFT]:
                    if (action != WALK || direction !== LEFT) { 
                        direction = LEFT;
                        walk(direction); 
                    }
                    break;
                case KEYPRESS[KP_ATTACK]:
                    if (action !== ATTACK) {
                        attack(direction);
                    }
                    break;
                default: return; // exit this handler for other keys
            }
        }
        e.preventDefault(); // prevent the default action (scroll / move caret)
    });

    function shouldThrottle(lastKeypressTime) {
        var elapsed = KEYPRESS_THROTTLE_DELAY;
        if (typeof lastKeypressTime !== undefined) {
            elapsed = new Date().getTime() - lastKeypressTime
        }
        return elapsed < KEYPRESS_THROTTLE_DELAY;
    }

})})})});
</script> 
</head>
<body>
<div class="barbarian"></div>
<div class="monster"></div>
</body>
</html>

